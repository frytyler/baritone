{"version":3,"sources":["spotify.js","index.js"],"names":["spotifyPortOffset","process","env","on","error","console","log","code","SERVER_PORT","UPDATE_INTERVAL","DEFAULT_RETURN_ON","DEFAULT_HTTPS_CONFIG","host","port","path","headers","Origin","version","running","csrf","oauth","albumId","coverUrl","mainWindow","trackUri","track","copyConfig","configOverride","configCopy","JSON","parse","stringify","Object","assign","generateLocalHostname","generateUrl","getUrl","getJson","callback","options","url","rejectUnauthorized","response","body","getStatus","config","join","getCurrentAlbumId","data","webContents","send","album_resource","uri","getAlbumCover","playing_position","length","playing","shuffle","repeat","next_enabled","prev_enabled","track_resource","name","artist_resource","ex","seek","percent","time","pause","playpause","skip","forward","repeating","id","thumbnail_url","grabTokens","token","t","updateTrackCover","waitForRequest","setInterval","clearInterval","setWindow","window","init","waitForSpotify","spotify","mb","dir","__dirname","preloadWindow","height","appLauncher","settings","showTrackTitle","smallAlbumArt","contextMenu","buildFromTemplate","label","click","openAbout","type","checked","item","isEnabled","then","enabled","disable","enable","app","quit","items","openSettings","settingsWindow","width","loadURL","aboutWindow","tray","popUpContextMenu","event"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;;;;AACA;;;;AACA;;;;AACA;;IAAYsF;;;;;;AAEZ;AACA;AACA,MAAMC,KAAK,uBAAQ;AACfC,SAAKC,YAAY,MADF;AAEfC,mBAAe,IAFA;AAGfC,YAAQ;AAHO,CAAR,CAAX;;AAMA;;AAEA,IAAIC,cAAc,yBAAe;AAC7B9B,UAAM;AADuB,CAAf,CAAlB;;AAIA,MAAM+B,WAAW;AACbC,oBAAgB,IADH;AAEbC,mBAAe;AAFF,CAAjB;;AAKA,MAAMC,cAAc,eAAKC,iBAAL,CAAuB,CACvC;AACIC,WAAO,gBADX;AAEIC,WAAOC;AAFX,CADuC,EAKvC,EAAEC,MAAM,WAAR,EALuC,EAMvC;AACIH,WAAO,iBADX;AAEIG,UAAM,UAFV;AAGIC,aAAS,KAHb;AAIIH,WAAOI,QAAQ;AACXX,oBAAYY,SAAZ,GAAwBC,IAAxB,CAA6BC,WAAW;AACpC,gBAAIA,OAAJ,EAAa;AACT,uBAAOd,YAAYe,OAAZ,GAAsBF,IAAtB,CAA2B,MAAM;AACpCF,yBAAKD,OAAL,GAAe,KAAf;AACH,iBAFM,CAAP;AAGH,aAJD,MAIO;AACH,uBAAOV,YAAYgB,MAAZ,GAAqBH,IAArB,CAA0B,MAAM;AACnCF,yBAAKD,OAAL,GAAe,IAAf;AACH,iBAFM,CAAP;AAGH;AACJ,SAVD;AAWH;AAhBL,CANuC,EAwBvC;AACIJ,WAAO,iBADX;AAEIG,UAAM,UAFV;AAGIC,aAAS,KAHb;AAIIH,WAAOI,QAAQ;AACXV,iBAASC,cAAT,GAA0B,CAACD,SAASC,cAApC;AACAS,aAAKD,OAAL,GAAeT,SAASC,cAAxB;AACAP,WAAGJ,MAAH,CAAUlC,WAAV,CAAsBC,IAAtB,CAA2B,UAA3B,EAAuC2C,QAAvC;AACH,KARL;AASIa,aAAS;AATb,CAxBuC,EAmCvC,EAAEL,MAAM,WAAR,EAnCuC,EAoCvC;AACIH,WAAO,eADX;AAEIC,WAAO,MAAMZ,GAAGsB,GAAH,CAAOC,IAAP;AAFjB,CApCuC,CAAvB,CAApB;;AA0CAlB,YAAYY,SAAZ,GAAwBC,IAAxB,CAA6BC,WAAW;AACpCV,gBAAYe,KAAZ,CAAkB,CAAlB,EAAqBT,OAArB,GAA+BI,OAA/B;AACH,CAFD;;AAIAV,YAAYe,KAAZ,CAAkB,CAAlB,EAAqBT,OAArB,GAA+BT,SAASC,cAAxC;AACA;;AAEA,SAASkB,YAAT,GAAwB;AACpB,UAAMC,iBAAiB,4BAAkB,EAAEC,OAAO,GAAT,EAAcvB,QAAQ,GAAtB,EAAlB,CAAvB;;AAEAsB,mBAAeE,OAAf,CAAuB,YAAY1B,SAAZ,GAAwB,gBAA/C;AACH;;AAED,SAASW,SAAT,GAAqB;AACjB,UAAMgB,cAAc,4BAAkB,EAAEF,OAAO,GAAT,EAAcvB,QAAQ,GAAtB,EAAlB,CAApB;;AAEAyB,gBAAYD,OAAZ,CAAoB,YAAY1B,SAAZ,GAAwB,gBAA5C;AACH;;AAEDF,GAAGpF,EAAH,CAAM,OAAN,EAAe,MAAM;AACjBE,YAAQC,GAAR,CAAY,cAAZ;AACAgF,YAAQF,IAAR;AACAG,OAAG8B,IAAH,CAAQlH,EAAR,CAAW,aAAX,EAA0B,MAAM;AAC5BoF,WAAG8B,IAAH,CAAQC,gBAAR,CAAyBtB,WAAzB;AACH,KAFD;AAGH,CAND;;AAQAT,GAAGpF,EAAH,CAAM,qBAAN,EAA6B,MAAM;AAC/BmF,YAAQJ,SAAR,CAAkBK,GAAGJ,MAArB;AACAI,OAAGJ,MAAH,CAAUlC,WAAV,CAAsBC,IAAtB,CAA2B,UAA3B,EAAuC2C,QAAvC;AACH,CAHD;;AAKA,kBAAQ1F,EAAR,CAAW,MAAX,EAAmB,CAACoH,KAAD,EAAQrD,OAAR,KAAoB;AACnCoB,YAAQrB,IAAR,CAAaC,OAAb;AACH,CAFD;;AAIA,kBAAQ/D,EAAR,CAAW,WAAX,EAAwB,CAACoH,KAAD,EAAQvE,IAAR,KAAiB;AACrCsC,YAAQjB,SAAR;AACH,CAFD;;AAIA,kBAAQlE,EAAR,CAAW,MAAX,EAAmB,CAACoH,KAAD,EAAQvE,IAAR,KAAiB;AAChCsC,YAAQhB,IAAR,CAAatB,IAAb;AACH,CAFD;;AAIA,kBAAQ7C,EAAR,CAAW,SAAX,EAAsB,CAACoH,KAAD,EAAQvE,IAAR,KAAiB;AACnCsC,YAAQ7B,OAAR,CAAgBT,IAAhB;AACH,CAFD;;AAIA,kBAAQ7C,EAAR,CAAW,QAAX,EAAqB,CAACoH,KAAD,EAAQvE,IAAR,KAAiB;AAClCsC,YAAQ5B,MAAR,CAAeV,IAAf;AACH,CAFD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ADlHA;;;;AACA;;AACA;;;;;;AAEA,IAAIhD,oBAAoB,CAAxB;;AAEAC,QAAQC,GAAR,CAAY,8BAAZ,IAA8C,GAA9C;AACAD,QAAQE,EAAR,CAAW,mBAAX,EAAgC,UAASC,KAAT,EAAgB;AAC5CC,YAAQC,GAAR,CAAYF,KAAZ;AACA,QAAIA,MAAMG,IAAN,IAAc,YAAlB,EAAgC;AAC5BP;AACAK,gBAAQC,GAAR,CAAY,uCAAZ;AACH;AACJ,CAND;;AAQA,MAAME,cAAc,IAApB;AACA,MAAMC,kBAAkB,IAAxB;AACA,MAAMC,oBAAoB,CAAC,OAAD,EAAU,QAAV,EAAoB,MAApB,EAA4B,OAA5B,EAAqC,OAArC,EAA8C,IAA9C,CAA1B;;AAEA,MAAMC,uBAAuB;AACzBC,UAAM,EADmB;AAEzBC,UAAM,IAFmB;AAGzBC,UAAM,EAHmB;AAIzBC,aAAS;AACLC,gBAAQ,0BADH;AAEL,sBACI;AAHC;AAJgB,CAA7B;;AAWA,IAAIC,UAAU,EAAEC,SAAS,KAAX,EAAd;AACA,IAAIC,IAAJ;AACA,IAAIC,KAAJ;AACA,IAAIC,OAAJ;AACA,IAAIC,QAAJ;AACA,IAAIC,UAAJ;AACA,IAAIC,QAAJ;AACA,IAAIC,KAAJ;;AAEA,SAASC,UAAT,CAAoBC,cAApB,EAAoC;AAChC,UAAMC,aAAaC,KAAKC,KAAL,CAAWD,KAAKE,SAAL,CAAepB,oBAAf,CAAX,CAAnB;AACAiB,eAAWf,IAAX,IAAmBb,oBAAoB,EAAvC;AACA,WAAOgC,OAAOC,MAAP,CAAc,EAAd,EAAkBL,UAAlB,EAA8BD,cAA9B,CAAP;AACH;;AAEM,MAAMO,wDAAwB,MAAM,WAApC;;AAEA,MAAMC,oCAAc,CAACvB,IAAD,EAAOC,IAAP,EAAaC,IAAb,KACtB,OAAMD,QAAQ,GAAR,GAAc,GAAd,GAAoB,EAAG,MAAKD,IAAK,IAAGC,IAAK,GAAEC,IAAK,EADpD;;AAGA,MAAMsB,0BAAStB,QAAQoB,0BAA0B,GAA1B,GAAgCpB,IAAvD;;AAEA,MAAMuB,4BAAU,CAAC,EAAEzB,IAAF,EAAQC,IAAR,EAAcC,IAAd,EAAoBC,OAApB,EAAD,EAAgCuB,QAAhC,KAA6C;AAChE,UAAMC,UAAU;AACZC,aAAKL,YAAYvB,IAAZ,EAAkBC,IAAlB,EAAwBC,IAAxB,CADO;AAEZ2B,4BAAoB,KAFR;AAGZ1B;AAHY,KAAhB;AAKA,2BAAQwB,OAAR,EAAiB,CAACnC,KAAD,EAAQsC,QAAR,EAAkBC,IAAlB,KAA2BL,SAAST,KAAKC,KAAL,CAAWa,IAAX,CAAT,CAA5C;AACH,CAPM;;AASA,MAAMC,gCAAY,YAAW;AAChC,UAAMC,SAASnB,WAAW;AACtBd,cAAMsB,uBADgB;AAEtBpB,cAAO,6BAA4BM,KAAM,SAAQD,IAAK,0BAAyBT,kBAAkBoC,IAAlB,EAAyB;AAFlF,KAAX,CAAf;AAIAT,YAAQQ,MAAR,EAAgBxC,QAAQC,GAAxB;AACH,CANM;;AAQA,MAAMyC,gDAAoB,MAAM;AACnC,UAAMF,SAASnB,WAAW;AACtBd,cAAMsB,uBADgB;AAEtBpB,cAAO,6BAA4BM,KAAM,SAAQD,IAAK,0BAAyBT,kBAAkBoC,IAAlB,EAAyB;AAFlF,KAAX,CAAf;AAIAT,YAAQQ,MAAR,EAAgBG,QAAQ;AACpB,YAAI,OAAOzB,UAAP,KAAsB,WAA1B,EAAuC;AACnCA,uBAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,SAA5B,EAAuCF,KAAK9B,OAA5C;AACH;AACD,YAAI;AACA,gBAAI8B,KAAKvB,KAAL,CAAW0B,cAAX,CAA0BC,GAA1B,KAAkC/B,OAAtC,EAA+C;AAC3ChB,wBAAQC,GAAR,CAAY,eAAZ;AACAe,0BAAU2B,KAAKvB,KAAL,CAAW0B,cAAX,CAA0BC,GAApC;AACA3B,wBAAQuB,KAAKvB,KAAb;AACApB,wBAAQC,GAAR,CAAY,EAAEe,OAAF,EAAZ;AACAgC,8BAAchC,OAAd;AACH,aAND,MAMO;AACH,oBAAI,OAAOE,UAAP,KAAsB,WAA1B,EAAuC;AACnCA,+BAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,UAA5B,EAAwC5B,QAAxC;AACH;AACJ;AACD,gBAAI,OAAOC,UAAP,KAAsB,WAA1B,EAAuC;AACnCA,2BAAW0B,WAAX,CAAuBC,IAAvB,CACI,UADJ,EAEIF,KAAKM,gBAAL,GAAwBN,KAAKvB,KAAL,CAAW8B,MAAnC,GAA4C,GAFhD;AAIAhC,2BAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,QAA5B,EAAsCF,KAAKvB,KAAL,CAAW8B,MAAjD;AACAhC,2BAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,SAA5B,EAAuCF,KAAKQ,OAA5C;AACAjC,2BAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,SAA5B,EAAuCF,KAAKS,OAA5C;AACAlC,2BAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,QAA5B,EAAsCF,KAAKU,MAA3C;AACAnC,2BAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,cAA5B,EAA4CF,KAAKW,YAAjD;AACApC,2BAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,cAA5B,EAA4CF,KAAKY,YAAjD;AACArC,2BAAW0B,WAAX,CAAuBC,IAAvB,CACI,OADJ,EAEIF,KAAKvB,KAAL,CAAWoC,cAAX,CAA0BC,IAF9B;AAIAvC,2BAAW0B,WAAX,CAAuBC,IAAvB,CACI,OADJ,EAEIF,KAAKvB,KAAL,CAAW0B,cAAX,CAA0BW,IAF9B;AAIAvC,2BAAW0B,WAAX,CAAuBC,IAAvB,CACI,QADJ,EAEIF,KAAKvB,KAAL,CAAWsC,eAAX,CAA2BD,IAF/B;AAIH;AACJ,SApCD,CAoCE,OAAOE,EAAP,EAAW;AACT3D,oBAAQC,GAAR,CAAY0D,EAAZ;AACH;AACJ,KA3CD;AA4CH,CAjDM;;AAmDA,MAAMC,sBAAO,UAASC,OAAT,EAAkB;AAClC,QAAIC,OAAOD,UAAU,GAAV,GAAgBzC,MAAM8B,MAAjC;AACA,6BACI,yEACIY,IADJ,GAEI,GAHR;AAKH,CAPM;;AASA,MAAMC,wBAAQ,UAASA,KAAT,EAAgB;AACjC,6BACI,kDAAkDA,KAAlD,GACM,OADN,GAEM,SAAS,GAHnB;AAKH,CANM;;AAQA,MAAMC,gCAAY,YAAW;AAChC,6BAAK,0DAAL;AACH,CAFM;;AAIA,MAAMC,sBAAO,UAASC,OAAT,EAAkB;AAClC,6BACI,mDACKA,UAAU,MAAV,GAAmB,UADxB,IAEI,SAHR;AAKH,CANM;;AAQA,MAAMb,0BAAS,UAASc,SAAT,EAAoB;AACtC,6BACI,mEACIA,SADJ,GAEI,GAHR;AAKH,CANM;;AAQA,MAAMf,4BAAU,UAASA,OAAT,EAAkB;AACrC,6BACI,mEACIA,OADJ,GAEI,GAHR;AAKH,CANM;;AAQA,MAAMJ,wCAAgB,UAASoB,EAAT,EAAa;AACtC,UAAM5B,SAASnB,WAAW;AACtBd,cAAM,kBADgB;AAEtBE,cAAO,eAAc2D,EAAG,EAFF;AAGtB5D,cAAM;AAHgB,KAAX,CAAf;AAKAwB,YAAQQ,MAAR,EAAgBG,QAAQ;AACpB3C,gBAAQC,GAAR,CAAY0C,KAAK0B,aAAjB;AACApD,mBAAW0B,KAAK0B,aAAhB;AACA,YAAI,OAAOnD,UAAP,KAAsB,WAA1B,EAAuC;AACnCA,uBAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,UAA5B,EAAwC5B,QAAxC;AACH;AACJ,KAND;AAOH,CAbM;;AAeA,MAAMqD,kCAAa,YAAW;AACjC,QAAI,OAAOpD,UAAP,KAAsB,WAA1B,EAAuC;AACnCA,mBAAW0B,WAAX,CAAuBC,IAAvB,CAA4B,aAA5B,EAA2C,0BAA3C;AACH;AACDb,YACIX,WAAW;AACPd,cAAMsB,uBADC;AAEPpB,cAAM;AAFC,KAAX,CADJ,EAKIkC,QAAQ;AACJ7B,eAAO6B,KAAK4B,KAAZ;AACH,KAPL;AASAvC,YACIX,WAAW;AACPd,cAAM,kBADC;AAEPE,cAAM,QAFC;AAGPD,cAAM;AAHC,KAAX,CADJ,EAMI,UAASmC,IAAT,EAAe;AACX5B,gBAAQ4B,KAAK6B,CAAb;AACH,KARL;AAUA,QAAIC,gBAAJ;AACA,QAAIC,iBAAiBC,YAAY,YAAW;AACxC,YACI,OAAO/D,OAAP,KAAmB,WAAnB,IACA,OAAOE,IAAP,KAAgB,WADhB,IAEA,OAAOC,KAAP,KAAiB,WAHrB,EAIE;AACE6D,0BAAcF,cAAd;AACA1E,oBAAQC,GAAR,CAAY,OAAZ;AACAD,oBAAQC,GAAR,CAAY,EAAEW,OAAF,EAAZ;AACAZ,oBAAQC,GAAR,CAAY,EAAEa,IAAF,EAAZ;AACAd,oBAAQC,GAAR,CAAY,EAAEc,KAAF,EAAZ;AACA0D,+BAAmBE,YAAYjC,iBAAZ,EAA+BtC,eAA/B,CAAnB;AACH,SAXD,MAWO;AACHJ,oBAAQC,GAAR,CAAY,+BAAZ;AACH;AACJ,KAfoB,EAelB,GAfkB,CAArB;AAgBH,CAxCM;;AA0CA,MAAM4E,gCAAY,UAASC,MAAT,EAAiB;AACtC5D,iBAAa4D,MAAb;AACA;AACH,CAHM;;AAKA,MAAMC,sBAAO,YAAW;AAC3B,QAAIC,iBAAiBL,YAAY,MAAM;AACnC,YAAI,OAAO/D,OAAP,KAAmB,WAAnB,IAAkCA,QAAQC,OAA9C,EAAuD;AACnD+D,0BAAcI,cAAd;AACAV;AACH,SAHD,MAGO;AACH,kBAAM9B,SAASnB,WAAW;AACtBd,sBAAMsB,uBADgB;AAEtBpB,sBAAM;AAFgB,aAAX,CAAf;AAIAuB,oBAAQQ,MAAR,EAAgB,CAACG,IAAD,EAAOnC,IAAP,KAAgB;AAC5B,oBAAI,EAAE,aAAamC,IAAf,CAAJ,EAA0B;AACtBA,yBAAK9B,OAAL,GAAe,IAAf;AACH;AACDD,0BAAU+B,IAAV;AACA3C,wBAAQC,GAAR,CAAYW,OAAZ;AACAZ,wBAAQC,GAAR,CAAY,WAAWO,IAAvB;AACAgC,uBAAOhC,IAAP,GAAcA,IAAd;AACH,aARD;AASAR,oBAAQC,GAAR,CAAY,wBAAZ;AACAuC,mBAAOhC,IAAP;AACH;AACJ,KArBoB,EAqBlB,GArBkB,CAArB;AAsBH,CAvBM","file":"index.map","sourcesContent":["import https from 'https';\nimport { exec } from 'child_process';\nimport request from 'request';\n\nlet spotifyPortOffset = 0;\n\nprocess.env['NODE_TLS_REJECT_UNAUTHORIZED'] = '0';\nprocess.on('uncaughtException', function(error) {\n    console.log(error);\n    if (error.code == 'ECONNRESET') {\n        spotifyPortOffset++;\n        console.log('connection failed; trying new port...');\n    }\n});\n\nconst SERVER_PORT = 5000;\nconst UPDATE_INTERVAL = 1000;\nconst DEFAULT_RETURN_ON = ['login', 'logout', 'play', 'pause', 'error', 'ap'];\n\nconst DEFAULT_HTTPS_CONFIG = {\n    host: '',\n    port: 4380,\n    path: '',\n    headers: {\n        Origin: 'https://open.spotify.com',\n        'User-Agent':\n            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36',\n    },\n};\n\nlet version = { running: false };\nlet csrf;\nlet oauth;\nlet albumId;\nlet coverUrl;\nlet mainWindow;\nlet trackUri;\nlet track;\n\nfunction copyConfig(configOverride) {\n    const configCopy = JSON.parse(JSON.stringify(DEFAULT_HTTPS_CONFIG));\n    configCopy.port += spotifyPortOffset % 10;\n    return Object.assign({}, configCopy, configOverride);\n}\n\nexport const generateLocalHostname = () => '127.0.0.1';\n\nexport const generateUrl = (host, port, path) =>\n    `http${port == 443 ? 's' : ''}://${host}:${port}${path}`;\n\nexport const getUrl = path => generateLocalHostname() + '/' + path;\n\nexport const getJson = ({ host, port, path, headers }, callback) => {\n    const options = {\n        url: generateUrl(host, port, path),\n        rejectUnauthorized: false,\n        headers,\n    };\n    request(options, (error, response, body) => callback(JSON.parse(body)));\n};\n\nexport const getStatus = function() {\n    const config = copyConfig({\n        host: generateLocalHostname(),\n        path: `/remote/status.json?oauth=${oauth}&csrf=${csrf}&returnafter=1returnon=${DEFAULT_RETURN_ON.join()}`,\n    });\n    getJson(config, console.log);\n};\n\nexport const getCurrentAlbumId = () => {\n    const config = copyConfig({\n        host: generateLocalHostname(),\n        path: `/remote/status.json?oauth=${oauth}&csrf=${csrf}&returnafter=1returnon=${DEFAULT_RETURN_ON.join()}`,\n    });\n    getJson(config, data => {\n        if (typeof mainWindow !== 'undefined') {\n            mainWindow.webContents.send('running', data.running);\n        }\n        try {\n            if (data.track.album_resource.uri !== albumId) {\n                console.log('album updated');\n                albumId = data.track.album_resource.uri;\n                track = data.track;\n                console.log({ albumId });\n                getAlbumCover(albumId);\n            } else {\n                if (typeof mainWindow !== 'undefined') {\n                    mainWindow.webContents.send('coverUrl', coverUrl);\n                }\n            }\n            if (typeof mainWindow !== 'undefined') {\n                mainWindow.webContents.send(\n                    'position',\n                    data.playing_position / data.track.length * 100\n                );\n                mainWindow.webContents.send('length', data.track.length);\n                mainWindow.webContents.send('playing', data.playing);\n                mainWindow.webContents.send('shuffle', data.shuffle);\n                mainWindow.webContents.send('repeat', data.repeat);\n                mainWindow.webContents.send('next_enabled', data.next_enabled);\n                mainWindow.webContents.send('prev_enabled', data.prev_enabled);\n                mainWindow.webContents.send(\n                    'track',\n                    data.track.track_resource.name\n                );\n                mainWindow.webContents.send(\n                    'album',\n                    data.track.album_resource.name\n                );\n                mainWindow.webContents.send(\n                    'artist',\n                    data.track.artist_resource.name\n                );\n            }\n        } catch (ex) {\n            console.log(ex);\n        }\n    });\n};\n\nexport const seek = function(percent) {\n    var time = percent / 100 * track.length;\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to set player position to ' +\n            time +\n            \"'\"\n    );\n};\n\nexport const pause = function(pause) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to ' + pause\n            ? 'pause'\n            : 'play' + \"'\"\n    );\n};\n\nexport const playpause = function() {\n    exec('osascript -e \\'tell application \"Spotify\" to playpause\\'');\n};\n\nexport const skip = function(forward) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to ' +\n            (forward ? 'next' : 'previous') +\n            \" track'\"\n    );\n};\n\nexport const repeat = function(repeating) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to set repeating to ' +\n            repeating +\n            \"'\"\n    );\n};\n\nexport const shuffle = function(shuffle) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to set shuffling to ' +\n            shuffle +\n            \"'\"\n    );\n};\n\nexport const getAlbumCover = function(id) {\n    const config = copyConfig({\n        host: 'open.spotify.com',\n        path: `/oembed?url=${id}`,\n        port: 443,\n    });\n    getJson(config, data => {\n        console.log(data.thumbnail_url);\n        coverUrl = data.thumbnail_url;\n        if (typeof mainWindow !== 'undefined') {\n            mainWindow.webContents.send('coverUrl', coverUrl);\n        }\n    });\n};\n\nexport const grabTokens = function() {\n    if (typeof mainWindow !== 'undefined') {\n        mainWindow.webContents.send('loadingText', 'Connecting to Spotify...');\n    }\n    getJson(\n        copyConfig({\n            host: generateLocalHostname(),\n            path: '/simplecsrf/token.json',\n        }),\n        data => {\n            csrf = data.token;\n        }\n    );\n    getJson(\n        copyConfig({\n            host: 'open.spotify.com',\n            path: '/token',\n            port: 443,\n        }),\n        function(data) {\n            oauth = data.t;\n        }\n    );\n    let updateTrackCover;\n    let waitForRequest = setInterval(function() {\n        if (\n            typeof version !== 'undefined' &&\n            typeof csrf !== 'undefined' &&\n            typeof oauth !== 'undefined'\n        ) {\n            clearInterval(waitForRequest);\n            console.log('done.');\n            console.log({ version });\n            console.log({ csrf });\n            console.log({ oauth });\n            updateTrackCover = setInterval(getCurrentAlbumId, UPDATE_INTERVAL);\n        } else {\n            console.log('waiting for authentication...');\n        }\n    }, 500);\n};\n\nexport const setWindow = function(window) {\n    mainWindow = window;\n    //console.log(mainWindow);\n};\n\nexport const init = function() {\n    let waitForSpotify = setInterval(() => {\n        if (typeof version !== 'undefined' && version.running) {\n            clearInterval(waitForSpotify);\n            grabTokens();\n        } else {\n            const config = copyConfig({\n                host: generateLocalHostname(),\n                path: '/service/version.json?service=remote',\n            });\n            getJson(config, (data, port) => {\n                if (!('running' in data)) {\n                    data.running = true;\n                }\n                version = data;\n                console.log(version);\n                console.log('port: ' + port);\n                config.port = port;\n            });\n            console.log('waiting for spotify...');\n            config.port++;\n        }\n    }, 500);\n};\n","import menubar from 'menubar';\nimport electron, { ipcMain, Menu, BrowserWindow } from 'electron';\nimport AutoLaunch from 'auto-launch';\nimport * as spotify from './spotify.js';\n\n// const Menu = electron.Menu;\n// const BrowserWindow = electron.BrowserWindow;\nconst mb = menubar({\n    dir: __dirname + '/../',\n    preloadWindow: true,\n    height: 464,\n});\n\n// const ipcMain = electron.ipcMain;\n\nlet appLauncher = new AutoLaunch({\n    name: 'spotifymenubar',\n});\n\nconst settings = {\n    showTrackTitle: true,\n    smallAlbumArt: false,\n};\n\nconst contextMenu = Menu.buildFromTemplate([\n    {\n        label: 'About Baritone',\n        click: openAbout,\n    },\n    { type: 'separator' },\n    {\n        label: 'Launch on Login',\n        type: 'checkbox',\n        checked: false,\n        click: item => {\n            appLauncher.isEnabled().then(enabled => {\n                if (enabled) {\n                    return appLauncher.disable().then(() => {\n                        item.checked = false;\n                    });\n                } else {\n                    return appLauncher.enable().then(() => {\n                        item.checked = true;\n                    });\n                }\n            });\n        },\n    },\n    {\n        label: 'Show Track Info',\n        type: 'checkbox',\n        checked: false,\n        click: item => {\n            settings.showTrackTitle = !settings.showTrackTitle;\n            item.checked = settings.showTrackTitle;\n            mb.window.webContents.send('settings', settings);\n        },\n        enabled: true,\n    },\n    { type: 'separator' },\n    {\n        label: 'Quit Baritone',\n        click: () => mb.app.quit(),\n    },\n]);\n\nappLauncher.isEnabled().then(enabled => {\n    contextMenu.items[2].checked = enabled;\n});\n\ncontextMenu.items[3].checked = settings.showTrackTitle;\n//contextMenu.items[4].checked = settings.smallAlbumArt;\n\nfunction openSettings() {\n    const settingsWindow = new BrowserWindow({ width: 400, height: 500 });\n\n    settingsWindow.loadURL('file://' + __dirname + '/settings.html');\n}\n\nfunction openAbout() {\n    const aboutWindow = new BrowserWindow({ width: 400, height: 320 });\n\n    aboutWindow.loadURL('file://' + __dirname + '/../about.html');\n}\n\nmb.on('ready', () => {\n    console.log('app is ready');\n    spotify.init();\n    mb.tray.on('right-click', () => {\n        mb.tray.popUpContextMenu(contextMenu);\n    });\n});\n\nmb.on('after-create-window', () => {\n    spotify.setWindow(mb.window);\n    mb.window.webContents.send('settings', settings);\n});\n\nipcMain.on('seek', (event, percent) => {\n    spotify.seek(percent);\n});\n\nipcMain.on('playpause', (event, data) => {\n    spotify.playpause();\n});\n\nipcMain.on('skip', (event, data) => {\n    spotify.skip(data);\n});\n\nipcMain.on('shuffle', (event, data) => {\n    spotify.shuffle(data);\n});\n\nipcMain.on('repeat', (event, data) => {\n    spotify.repeat(data);\n});\n"]}