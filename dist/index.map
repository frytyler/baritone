{"version":3,"sources":["spotify.js","authenticate.js","index.js"],"names":["store","name","spotifyPortOffset","process","env","on","error","console","log","code","SERVER_PORT","UPDATE_INTERVAL","DEFAULT_RETURN_ON","DEFAULT_HTTPS_CONFIG","host","port","path","headers","Origin","version","running","csrf","oauth","albumId","coverUrl","mainWindow","trackUri","track","copyConfig","configOverride","configCopy","JSON","parse","stringify","Object","assign","generateLocalHostname","generateUrl","getUrl","getJson","callback","options","url","rejectUnauthorized","response","body","getStatus","config","join","getCurrentAlbumId","access_token","get","Authorization","json","err","res","status","delete","getCurrentAlbumId2","data","webContents","send","album_resource","uri","getAlbumCover","trackInfo","song","track_resource","album","artist","artist_resource","time","length","current","Math","round","playing_position","remaining","parseFloat","toFixed","playing","shuffle","repeat","next_enabled","prev_enabled","ex","seek","percent","pause","playpause","skip","forward","repeating","id","thumbnail_url","grabTokens","token","t","updateTrackCover","waitForRequest","setInterval","clearInterval","setWindow","window","init","waitForSpotify","router","stateKey","tokenStatekey","client_id","client_secret","redirect_uri","authWindow","generateRandomString","text","possible","i","charAt","floor","random","req","width","height","state","set","scope","loadURL","response_type","query","storedState","authOptions","form","grant_type","Buffer","toString","post","statusCode","refresh_token","close","spotify","app","use","mb","dir","__dirname","preloadWindow","appLauncher","settings","showTrackTitle","smallAlbumArt","contextMenu","buildFromTemplate","label","click","openAbout","type","checked","item","isEnabled","then","enabled","disable","enable","quit","items","openSettings","settingsWindow","aboutWindow","tray","popUpContextMenu","openDevTools","event","listen"],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACnHf;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;IAAYiC;;AACZ;;;;;;;;AAEA,MAAMC,MAAM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","file":"index.map","sourcesContent":["import https from 'https';\nimport { exec } from 'child_process';\nimport request from 'request';\nimport Store from 'electron-store';\n\nconst store = new Store({ name: 'auth' });\n\nlet spotifyPortOffset = 0;\n\nprocess.env['NODE_TLS_REJECT_UNAUTHORIZED'] = '0';\nprocess.on('uncaughtException', function(error) {\n    console.log(error);\n    if (error.code == 'ECONNRESET') {\n        spotifyPortOffset++;\n        console.log('connection failed; trying new port...');\n    }\n});\n\nconst SERVER_PORT = 5000;\nconst UPDATE_INTERVAL = 1000;\nconst DEFAULT_RETURN_ON = ['login', 'logout', 'play', 'pause', 'error', 'ap'];\n\nconst DEFAULT_HTTPS_CONFIG = {\n    host: '',\n    port: 4380,\n    path: '',\n    headers: {\n        Origin: 'https://open.spotify.com',\n        'User-Agent':\n            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36',\n    },\n};\n\nlet version = { running: false };\nlet csrf;\nlet oauth;\nlet albumId;\nlet coverUrl;\nlet mainWindow;\nlet trackUri;\nlet track;\n\nfunction copyConfig(configOverride) {\n    const configCopy = JSON.parse(JSON.stringify(DEFAULT_HTTPS_CONFIG));\n    configCopy.port += spotifyPortOffset % 10;\n    return Object.assign({}, configCopy, configOverride);\n}\n\nexport const generateLocalHostname = () => '127.0.0.1';\n\nexport const generateUrl = (host, port, path) =>\n    `http${port == 443 ? 's' : ''}://${host}:${port}${path}`;\n\nexport const getUrl = path => generateLocalHostname() + '/' + path;\n\nexport const getJson = ({ host, port, path, headers }, callback) => {\n    const options = {\n        url: generateUrl(host, port, path),\n        rejectUnauthorized: false,\n        headers,\n    };\n    request(options, (error, response, body) => callback(JSON.parse(body)));\n};\n\nexport const getStatus = function() {\n    const config = copyConfig({\n        host: generateLocalHostname(),\n        path: `/remote/status.json?oauth=${oauth}&csrf=${csrf}&returnafter=1returnon=${DEFAULT_RETURN_ON.join()}`,\n    });\n    getJson(config, console.log);\n};\n\nexport const getCurrentAlbumId = () => {\n    const { access_token } = store.get('tokens');\n\n    const options = {\n        url: 'https://api.spotify.com/v1/me/player',\n        headers: { Authorization: 'Bearer ' + access_token },\n        json: true,\n    };\n    request.get(options, (err, res, body) => {\n        if (body.error && body.error.status === 401) store.delete('tokens');\n        console.log({ body });\n    });\n};\n\nexport const getCurrentAlbumId2 = () => {\n    const config = copyConfig({\n        host: generateLocalHostname(),\n        path: `/remote/status.json?oauth=${oauth}&csrf=${csrf}&returnafter=1returnon=${DEFAULT_RETURN_ON.join()}`,\n    });\n    getJson(config, data => {\n        if (typeof mainWindow !== 'undefined') {\n            mainWindow.webContents.send('running', data.running);\n        }\n        try {\n            if (data.track.album_resource.uri !== albumId) {\n                console.log('album updated');\n                albumId = data.track.album_resource.uri;\n                track = data.track;\n                console.log({ albumId });\n                getAlbumCover(albumId);\n            } else {\n                if (typeof mainWindow !== 'undefined') {\n                    mainWindow.webContents.send('coverUrl', coverUrl);\n                }\n            }\n            if (typeof mainWindow !== 'undefined') {\n                const { track } = data;\n\n                const trackInfo = {\n                    song: track.track_resource.name,\n                    album: track.album_resource.name,\n                    artist: track.artist_resource.name,\n                    time: {\n                        length: track.length / 60,\n                        current: Math.round(data.playing_position),\n                        remaining: parseFloat(track.length / 60).toFixed(2),\n                    },\n                };\n                // console.log(trackInfo);\n\n                mainWindow.webContents.send('trackInfo', trackInfo);\n\n                mainWindow.webContents.send(\n                    'position',\n                    data.playing_position / data.track.length * 100\n                );\n                mainWindow.webContents.send('length', data.track.length);\n                mainWindow.webContents.send('playing', data.playing);\n                mainWindow.webContents.send('shuffle', data.shuffle);\n                mainWindow.webContents.send('repeat', data.repeat);\n                mainWindow.webContents.send('next_enabled', data.next_enabled);\n                mainWindow.webContents.send('prev_enabled', data.prev_enabled);\n                mainWindow.webContents.send(\n                    'track',\n                    data.track.track_resource.name\n                );\n                mainWindow.webContents.send(\n                    'album',\n                    data.track.album_resource.name\n                );\n                mainWindow.webContents.send(\n                    'artist',\n                    data.track.artist_resource.name\n                );\n            }\n        } catch (ex) {\n            console.log(ex);\n        }\n    });\n};\n\nexport const seek = function(percent) {\n    var time = percent / 100 * track.length;\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to set player position to ' +\n            time +\n            \"'\"\n    );\n};\n\nexport const pause = function(pause) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to ' + pause\n            ? 'pause'\n            : 'play' + \"'\"\n    );\n};\n\nexport const playpause = function() {\n    exec('osascript -e \\'tell application \"Spotify\" to playpause\\'');\n};\n\nexport const skip = function(forward) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to ' +\n            (forward ? 'next' : 'previous') +\n            \" track'\"\n    );\n};\n\nexport const repeat = function(repeating) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to set repeating to ' +\n            repeating +\n            \"'\"\n    );\n};\n\nexport const shuffle = function(shuffle) {\n    exec(\n        'osascript -e \\'tell application \"Spotify\" to set shuffling to ' +\n            shuffle +\n            \"'\"\n    );\n};\n\nexport const getAlbumCover = function(id) {\n    const config = copyConfig({\n        host: 'open.spotify.com',\n        path: `/oembed?url=${id}`,\n        port: 443,\n    });\n    getJson(config, data => {\n        console.log(data.thumbnail_url);\n        coverUrl = data.thumbnail_url;\n        if (typeof mainWindow !== 'undefined') {\n            mainWindow.webContents.send('coverUrl', coverUrl);\n        }\n    });\n};\n\nexport const grabTokens = function() {\n    if (typeof mainWindow !== 'undefined') {\n        mainWindow.webContents.send('loadingText', 'Connecting to Spotify...');\n    }\n    getJson(\n        copyConfig({\n            host: generateLocalHostname(),\n            path: '/simplecsrf/token.json',\n        }),\n        data => {\n            csrf = data.token;\n        }\n    );\n    getJson(\n        copyConfig({\n            host: 'open.spotify.com',\n            path: '/token',\n            port: 443,\n        }),\n        function(data) {\n            oauth = data.t;\n        }\n    );\n    let updateTrackCover;\n    let waitForRequest = setInterval(function() {\n        if (\n            typeof version !== 'undefined' &&\n            typeof csrf !== 'undefined' &&\n            typeof oauth !== 'undefined'\n        ) {\n            clearInterval(waitForRequest);\n            console.log('done.');\n            console.log({ version });\n            console.log({ csrf });\n            console.log({ oauth });\n            updateTrackCover = setInterval(getCurrentAlbumId, UPDATE_INTERVAL);\n        } else {\n            console.log('waiting for authentication...');\n        }\n    }, 500);\n};\n\nexport const setWindow = function(window) {\n    mainWindow = window;\n    //console.log(mainWindow);\n};\n\nexport const init = function() {\n    let waitForSpotify = setInterval(() => {\n        if (typeof version !== 'undefined' && version.running) {\n            clearInterval(waitForSpotify);\n            grabTokens();\n        } else {\n            const config = copyConfig({\n                host: generateLocalHostname(),\n                path: '/service/version.json?service=remote',\n            });\n            getJson(config, (data, port) => {\n                if (!('running' in data)) {\n                    data.running = true;\n                }\n                version = data;\n                console.log(version);\n                console.log('port: ' + port);\n                config.port = port;\n            });\n            console.log('waiting for spotify...');\n            config.port++;\n        }\n    }, 500);\n};\n","import { Router } from 'express';\nimport querystring from 'querystring';\nimport { BrowserWindow } from 'electron';\nimport request from 'request';\nimport Store from 'electron-store';\n\nconst store = new Store({ name: 'auth' });\nconst router = Router();\n\nconst stateKey = 'spotify_auth_state';\nconst tokenStatekey = 'tokens';\nconst client_id = 'dac3a81dc39d4871bed298674cbb19d9'; // Your client id\nconst client_secret = 'd3c86d0a9bac494bad1069ac6ecedc2d'; // Your secret\nconst redirect_uri = 'http://localhost:3000/callback'; // Your redirect uri\nlet authWindow;\n\nconst generateRandomString = function(length) {\n    var text = '';\n    var possible =\n        'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n    for (var i = 0; i < length; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    return text;\n};\n\nrouter.get('/login', (req, res) => {\n    authWindow = new BrowserWindow({ width: 600, height: 700 });\n    const state = generateRandomString(16);\n    store.set(stateKey, state);\n\n    // your application requests authorization\n    var scope =\n        'user-read-private user-read-email playlist-read-private user-top-read user-library-read playlist-modify-private user-read-currently-playing user-read-recently-played user-follow-modify user-modify-playback-state user-read-playback-state user-follow-read user-library-modify streaming playlist-modify-public playlist-read-collaborative';\n    authWindow.loadURL(\n        'https://accounts.spotify.com/authorize?' +\n            querystring.stringify({\n                response_type: 'code',\n                client_id,\n                scope,\n                redirect_uri,\n                state,\n            })\n    );\n});\n\nrouter.get('/callback', (req, res) => {\n    // your application requests refresh and access tokens\n    // after checking the state parameter\n\n    const { query: { code = null, state = null } } = req;\n    const storedState = store.get(stateKey) || null;\n\n    if (state === null || state !== storedState) {\n        // not sure what to do here.\n        // res.status(401).send('state_mismatch');\n    } else {\n        store.delete(stateKey);\n        var authOptions = {\n            url: 'https://accounts.spotify.com/api/token',\n            form: {\n                code,\n                redirect_uri,\n                grant_type: 'authorization_code',\n            },\n            headers: {\n                Authorization:\n                    'Basic ' +\n                    new Buffer(client_id + ':' + client_secret).toString(\n                        'base64'\n                    ),\n            },\n            json: true,\n        };\n\n        request.post(authOptions, function(error, response, body) {\n            if (!error && response.statusCode === 200) {\n                const { access_token, refresh_token } = body;\n\n                store.set(tokenStatekey, { access_token, refresh_token });\n\n                var options = {\n                    url: 'https://api.spotify.com/v1/me',\n                    headers: { Authorization: 'Bearer ' + access_token },\n                    json: true,\n                };\n\n                authWindow.close();\n\n                // use the access token to access the Spotify Web API\n                // request.get(options, function(error, response, body) {\n                //     console.log(body);\n                // });\n\n                // we can also pass the token to the browser to make requests from there\n                // res.redirect(\n                //     '/#' +\n                //         querystring.stringify({\n                //             access_token: access_token,\n                //             refresh_token: refresh_token,\n                //         })\n                // );\n            } else {\n                // res.redirect(\n                //     '/#' +\n                //         querystring.stringify({\n                //             error: 'invalid_token',\n                //         })\n                // );\n            }\n        });\n    }\n});\n\nexport default router;\n","import express from 'express';\nimport menubar from 'menubar';\nimport electron, { ipcMain, Menu, BrowserWindow } from 'electron';\nimport AutoLaunch from 'auto-launch';\n\nimport * as spotify from './spotify.js';\nimport authentication from './authenticate';\n\nconst app = express();\n\napp.use('/', authentication);\n\nconst mb = menubar({\n    dir: __dirname + '/../',\n    preloadWindow: true,\n    height: 550,\n});\n\nlet appLauncher = new AutoLaunch({\n    name: 'spotifymenubar',\n});\n\nconst settings = {\n    showTrackTitle: true,\n    smallAlbumArt: false,\n};\n\nconst contextMenu = Menu.buildFromTemplate([\n    {\n        label: 'About Baritone',\n        click: openAbout,\n    },\n    { type: 'separator' },\n    {\n        label: 'Launch on Login',\n        type: 'checkbox',\n        checked: false,\n        click: item => {\n            appLauncher.isEnabled().then(enabled => {\n                if (enabled) {\n                    return appLauncher.disable().then(() => {\n                        item.checked = false;\n                    });\n                } else {\n                    return appLauncher.enable().then(() => {\n                        item.checked = true;\n                    });\n                }\n            });\n        },\n    },\n    {\n        label: 'Show Track Info',\n        type: 'checkbox',\n        checked: false,\n        click: item => {\n            settings.showTrackTitle = !settings.showTrackTitle;\n            item.checked = settings.showTrackTitle;\n            mb.window.webContents.send('settings', settings);\n        },\n        enabled: true,\n    },\n    { type: 'separator' },\n    {\n        label: 'Quit Baritone',\n        click: () => mb.app.quit(),\n    },\n]);\n\nappLauncher.isEnabled().then(enabled => {\n    contextMenu.items[2].checked = enabled;\n});\n\ncontextMenu.items[3].checked = settings.showTrackTitle;\n\nfunction openSettings() {\n    const settingsWindow = new BrowserWindow({ width: 400, height: 500 });\n\n    settingsWindow.loadURL('file://' + __dirname + '/settings.html');\n}\n\nfunction openAbout() {\n    const aboutWindow = new BrowserWindow({ width: 400, height: 320 });\n\n    aboutWindow.loadURL('file://' + __dirname + '/../about.html');\n}\n\nmb.on('ready', () => {\n    console.log('app is ready');\n    spotify.init();\n    mb.tray.on('right-click', () => {\n        mb.tray.popUpContextMenu(contextMenu);\n    });\n});\n\nmb.on('after-create-window', () => {\n    spotify.setWindow(mb.window);\n    mb.window.openDevTools();\n    mb.window.webContents.send('settings', settings);\n});\n\nipcMain.on('seek', (event, percent) => spotify.seek(percent));\n\nipcMain.on('playpause', (event, data) => spotify.playpause());\n\nipcMain.on('skip', (event, data) => spotify.skip(data));\n\nipcMain.on('shuffle', (event, data) => spotify.shuffle(data));\n\nipcMain.on('repeat', (event, data) => spotify.repeat(data));\n\nconsole.log('Listing to http://localhost:3000');\napp.listen(3000);\n"]}